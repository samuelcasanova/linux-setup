---
# Role: bash
# Description: Configure bash shell with dotfiles
# Migrated from: install-software-scripts/10-bash.sh

- name: Check if bash configuration files are real files
  stat:
    path: "{{ item }}"
  loop:
    - ~/.bashrc
    - ~/.bash_env_vars
  register: bash_stats

- name: Backup existing bash configuration
  command: mv {{ item.item }} /tmp/
  args:
    removes: "{{ item.item }}"
  loop: "{{ bash_stats.results }}"
  when: item.stat.exists and not item.stat.islnk
  failed_when: false

- name: Deploy bash dotfiles from public repo
  command: stow -v -d {{ setup_repo }}/dotfiles/ -t ~ bash
  register: stow_bash_public
  changed_when: "'LINK' in stow_bash_public.stderr"

- name: Check if private dotfiles directory exists
  stat:
    path: "{{ setup_repo_private }}/dotfiles/bash"
  register: private_bash_dir

- name: Deploy bash dotfiles from private repo
  command: stow -v -d {{ setup_repo_private }}/dotfiles/ -t ~ bash
  register: stow_bash_private
  changed_when: "'LINK' in stow_bash_private.stderr"
  when: setup_repo_private is defined and private_bash_dir.stat.exists
