# Role: safeeyes
# Description: SafeEyes configuration and dotfiles
# Migrated from: install-software-scripts/80-safeeyes.sh (config part)

- name: Add SafeEyes PPA
  apt_repository:
    repo: ppa:safeeyes-team/safeeyes
    state: present
  become: yes

- name: Install SafeEyes
  apt:
    name: safeeyes
    state: present
    update_cache: yes
  become: yes

- name: Check if SafeEyes configuration files are real files
  stat:
    path: "{{ item }}"
  loop:
    - ~/.config/safeeyes
    - ~/.config/autostart/io.github.slgobinath.SafeEyes.desktop
  register: safeeyes_stats

- name: Backup existing SafeEyes configuration
  command: mv {{ item.item }} /tmp/
  args:
    removes: "{{ item.item }}"
  loop: "{{ safeeyes_stats.results }}"
  when: item.stat.exists and not item.stat.islnk
  failed_when: false

- name: Deploy SafeEyes dotfiles
  command: stow -v -d {{ setup_repo }}/dotfiles/ -t ~ safeeyes
  register: stow_safeeyes
  changed_when: "'LINK' in (stow_safeeyes.stderr | default(''))"
